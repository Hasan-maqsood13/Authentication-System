<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Signup Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #74ebd5, #acb6e5);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Segoe UI', sans-serif;
    }

    .signup-card {
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      padding: 30px;
      width: 100%;
      max-width: 400px;
    }

    .form-control:focus {
      border-color: #5cbfd1;
      box-shadow: 0 0 0 0.2rem rgba(92, 191, 209, 0.25);
    }

    .btn-custom {
      background-color: #5cbfd1;
      color: white;
      transition: all 0.3s ease;
    }

    .btn-custom:hover {
      background-color: #48aabf;
    }

    .form-check-label {
      font-size: 0.9rem;
    }

    .invalid {
      color: red;
    }
    #signup-spinner {
      animation: spinner-border .75s linear infinite;
    }
    @keyframes spinner-border {
      to { transform: rotate(360deg); }
    }
    .spinner-border {
      display: inline-block;
      width: 1rem;  /* or as per size */
      height: 1rem;
      vertical-align: text-bottom;
      border: 0.15em solid currentColor;
      border-right-color: transparent;
      border-radius: 50%;
      animation: spinner-border 0.75s linear infinite;
    }
    .spinner-border {
      animation: spinner-border 0.75s linear infinite !important;
      display: inline-block !important;
    }
    #signup-btn {
      position: relative;
      overflow: visible; /* make sure spinner not clipped */
    }

    #signup-spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: spinner-border 0.75s linear infinite !important;
    }


  </style>
</head>
<body>

  <div class="signup-card">
    <h3 class="text-center mb-4">Create Account</h3>
    <form method="POST" id="signup-form">
      {% csrf_token %}
      <div class="mb-3">
        <label for="name" class="form-label">Full Name</label>
        <input type="text" class="form-control {% if errors.name %}is-invalid{% endif %}" name="name" id="name" required value="{{ values.name|default:'' }}">
        {% if errors.name %}
        <div class="text-danger mt-1">{{ errors.name }}</div>
        {% endif %}
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Email address</label>
        <input type="email" class="form-control {% if errors.email %}is-invalid{% endif %}" id="email" name="email" required value="{{ values.email|default:'' }}">
        {% if errors.email %}
        <div class="text-danger mt-1">{{ errors.email }}</div>
        {% endif %}
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <input type="password" class="form-control {% if errors.password %}is-invalid{% endif %}" name="password" id="password" required>
        {% if errors.password %}
        <div class="text-danger mt-1">{{ errors.password }}</div>
        {% endif %}
      </div>

      <div id="password-contain" class="p-3 bg-light mb-2 rounded">
        <h5 class="fs-13">Password must contain:</h5>
        <p id="pass-length" class="invalid fs-12 mb-2">Minimum <b>8 characters</b></p>
        <p id="pass-lower" class="invalid fs-12 mb-2">At <b>lowercase</b> letter (a-z)</p>
        <p id="pass-upper" class="invalid fs-12 mb-2">At least <b>uppercase</b> letter (A-Z)</p>
        <p id="pass-number" class="invalid fs-12 mb-0">A least <b>number</b> (0-9)</p>
        <p id="pass-special" class="invalid fs-12 mb-0">At least one <b>special character</b> (!@#$...)</p>
      </div>

      <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="terms" required>
        <label class="form-check-label" for="terms">I agree to the <a href="#">terms and conditions</a></label>
      </div>

      <button type="submit" id="signup-btn" class="btn btn-custom w-100">
        <span id="signup-spinner" class="spinner-border spinner-border-sm text-white d-none" role="status" aria-hidden="true"></span>
        <span id="signup-text">Sign Up</span>
      </button>

    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const passwordInput = document.getElementById("password");
      const container = document.getElementById("password-contain");
      const passLength = document.getElementById("pass-length");
      const passLower = document.getElementById("pass-lower");
      const passUpper = document.getElementById("pass-upper");
      const passNumber = document.getElementById("pass-number");
      const passSpecial = document.getElementById("pass-special");


      container.style.display = "none";

      passwordInput.addEventListener("focus", function () {
        container.style.display = "block";
      });

      passwordInput.addEventListener("input", function () {
        const val = passwordInput.value;

        if (val.length >= 8) {
          passLength.classList.remove("invalid");
          passLength.classList.add("text-success");
        } else {
          passLength.classList.add("invalid");
          passLength.classList.remove("text-success");
        }

        if (/[a-z]/.test(val)) {
          passLower.classList.remove("invalid");
          passLower.classList.add("text-success");
        } else {
          passLower.classList.add("invalid");
          passLower.classList.remove("text-success");
        }

        if (/[A-Z]/.test(val)) {
          passUpper.classList.remove("invalid");
          passUpper.classList.add("text-success");
        } else {
          passUpper.classList.add("invalid");
          passUpper.classList.remove("text-success");
        }

        if (/\d/.test(val)) {
          passNumber.classList.remove("invalid");
          passNumber.classList.add("text-success");
        } else {
          passNumber.classList.add("invalid");
          passNumber.classList.remove("text-success");
        }

        if (/[!@#$%^&*(),.?":{}|<>]/.test(val)) {
            passSpecial.classList.remove("invalid");
            passSpecial.classList.add("text-success");
        } else {
            passSpecial.classList.add("invalid");
            passSpecial.classList.remove("text-success");
        }
      });

      passwordInput.addEventListener("blur", function () {
        container.style.display = "none";
      });
    });
  </script>
  <script>
    // CSRF token setup for AJAX
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    $.ajaxSetup({
      headers: { 'X-CSRFToken': csrftoken }
    });
    $(document).ready(function () {
      $('form').on('submit', function (e) {
        e.preventDefault(); // page reload se rokna

        $('#signup-spinner').removeClass('d-none');
        $('#signup-text').addClass('invisible');

        $.ajax({
          type: 'POST',
          url: '{% url "signup" %}',
          data: $(this).serialize(),
          success: function (response) {
            if (response.success) {
              Swal.fire({
                title: 'Account Created.',
                icon: 'success',
                timer: 5000,
                timerProgressBar: true,
                showConfirmButton: false,
                willClose: () => {
                  window.location.href = `/myapp/verify/?email=${response.email}`;
                }
              });
            } else {
              // Validation errors show karo
              $('.text-danger').remove(); // old errors hata do
              $('.is-invalid').removeClass('is-invalid');

              for (let field in response.errors) {
                let input = $(`[name="${field}"]`);
                input.addClass('is-invalid');
                input.after(`<div class="text-danger mt-1">${response.errors[field]}</div>`);
              }
            }

            $('#signup-spinner').addClass('d-none');
            $('#signup-text').removeClass('invisible');
          },
          error: function () {
            alert('Server error occurred.');
            $('#signup-spinner').addClass('d-none');
            $('#signup-text').removeClass('invisible');
          }
        });
      });
    });
  </script>
</body>
</html>
